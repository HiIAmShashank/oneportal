import { StrictMode } from 'react';
import { createRoot } from 'react-dom/client';
import { UnifiedAuthProvider } from '@one-portal/auth';
import { msalInstance, getAuthConfig } from './auth/msalInstance';
import { PUBLIC_ROUTES } from './config/routes';
import { ThemedSonner } from './components/ThemedSonner';
import { ThemeProvider } from './components/ThemeProvider';
import { isEmbeddedMode } from '@one-portal/auth/utils';
import App from './App';
import './app.css';
import './style.css';
import './styles/sidebar-overrides.css';

// Load debug utilities in development
if (import.meta.env.DEV) {
  import('./debug/authDebug');
}

/**
 * Standalone entry point for {{ displayName }}
 *
 * This file is used when running the app independently during development.
 * In production, the app is loaded via Module Federation (bootstrap.tsx).
 */
const container = document.getElementById('root');

if (!container) {
  throw new Error('[{{ displayName }}] Root element not found');
}

const root = createRoot(container);

const isStandalone = !isEmbeddedMode({
  mode: import.meta.env.VITE_APP_MODE as 'auto' | 'standalone' | 'embedded',
});

root.render(
  <StrictMode>
    <UnifiedAuthProvider
      msalInstance={msalInstance}
      mode="remote"
      appName="{{ appName }}"
      getAuthConfig={getAuthConfig}
      debug={import.meta.env.DEV}
      publicRoutes={PUBLIC_ROUTES}
    >
      {isStandalone ? (
        <ThemeProvider defaultTheme="system" storageKey="one-portal-ui-theme">
          <App />
          <ThemedSonner />
        </ThemeProvider>
      ) : (
        <App />
      )}
    </UnifiedAuthProvider>
  </StrictMode>
);
